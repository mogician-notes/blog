>**Sorry, the translation will be completed as soon as possible ğŸ˜…** 

ä»Šå¤©æ˜¯äº”ä¸€å‡æœŸçš„ç¬¬ä¸€å¤©ï¼Œåœ¨å®¶ç¡å¾—å¾ˆèˆ’æœï¼Œé‚£å°±èµ·æ¥å†™ç¯‡æ–‡ç« ã€‚

>æœ¬æ–‡ä¸»è¦è®²äº†Bonbonsçš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿæ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Œä½†æ€è·¯åŒæ ·é€‚ç”¨äºè®¾è®¡ä»»ä½•åå°IoCæ¡†æ¶

Bonbonsä¸€å¼€å§‹ä¾¿æ˜¯æ‰“ç®—æŒ‰ç…§IoCæ¨¡å¼è®¾è®¡çš„ï¼Œé‚£ä¹ˆéœ€è¦å®ç°ä¸€å¥—ä¾èµ–ç³»ç»Ÿï¼Œæ¥è§£å†³æ§åˆ¶å™¨ã€æœåŠ¡çš„æ³¨å…¥å…³ç³»ã€‚æˆ‘å¯¹å¾ˆå¤šè‘—åçš„IoCæ¡†æ¶ä¹Ÿä¸æ˜¯äº†è§£å¾ˆå¤šï¼Œæ‰€ä»¥åœ¨è¿™é‡Œåªæ˜¯ç®€å•è¯´è¯´Bonbonsçš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿçš„å®ç°ã€‚

>ç›®å‰Bonbonså·²ç»å®ç°ä¾èµ–æ³¨å…¥åŠŸèƒ½(Dependency Injection)ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰åšä¾èµ–æŸ¥æ‰¾(Dependency Lookup)çš„ç›¸å…³å®ç°ï¼Œä¸è¿‡åº”è¯¥å¾ˆå¿«ä¼šå®Œæˆï¼Œè¿™æ˜¯ä¸€ä¸ªå¿…å¤‡åŠŸèƒ½ã€‚

### åŸºæœ¬æ–¹å¼
Bonbonsçš„ä¾èµ–æ³¨å…¥åŸºæœ¬ä¸ŠæŒ‰ç…§æ¥å£å’Œæ„é€ æ–¹æ³•æ³¨å…¥æ¥å®Œæˆã€‚

ä¹‹æ‰€ä»¥è¯´æ˜¯åŸºæœ¬ä¸Šï¼Œå…¶å®æ˜¯å› ä¸ºåœ¨TypeScriptæœ¬èº«æ¥è¯´ï¼Œæ¥å£æ˜¯ä¸€ä¸ªè®¾è®¡æ¦‚å¿µï¼Œä¸ä¼šåæ˜ åœ¨JavaScriptçš„è¿è¡Œè¿‡ç¨‹é‡Œã€‚é‚£ä¹ˆå®Œå…¨ä½¿ç”¨TypeScriptçš„æ¥å£æ¦‚å¿µï¼Œæƒ³è¦å®ç°DIä¼šæœ‰å›°éš¾ï¼Œæ‰€ä»¥Bonbonsçš„DIç”¨åˆ°çš„æ¥å£å®é™…ä¸Šæ˜¯æŠ½è±¡ç±»(abstract class)ã€‚

åœ¨TypeScriptä¸­æŠ½è±¡ç±»æ˜¯ä¸å¯ä»¥å®ä¾‹åŒ–çš„ï¼Œä½†æ˜¯å¯ä»¥å‘æ¥å£ä¸€æ ·ï¼Œå®šä¹‰ä¸€äº›åˆ—çš„æŠ½è±¡æ–¹æ³•æˆ–å±æ€§å¹¶å¼ºåˆ¶éœ€è¦åœ¨ç»§æ‰¿ç±»ä¸­å®ç°ã€‚äº‹å®ä¸Šï¼ŒæŠ½è±¡ç±»åœ¨è½¬è¯‘åˆ°JavaScriptä¹‹åï¼Œå’Œæ™®é€šç±»å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„åŒºåˆ«ï¼Œæ‰€ä»¥åœ¨å®ç°ä¸Šï¼Œä¸éœ€è¦é¢å¤–å…³æ³¨æŠ½è±¡ç±»æœ¬èº«ã€‚

### ç»†èŠ‚

- æ— æ¥å£å®šä¹‰ç›´æ¥ç™»è®°
- æŠ½è±¡ç±»æ¥å£å®ç°ä¾èµ–åˆ†ç¦»
- å¯æ³¨å…¥é¡¹çš„ä¾èµ–å·¥å‚
- å•ä¾‹æ¨¡å¼å’ŒèŒƒå›´æ¨¡å¼
- æ³¨å…¥ç°æˆçš„çš„æ¥å£å®ä¾‹
- ä¾èµ–é‡‘å­—å¡”ä¸å¼•ç”¨è§£æ
- ä¾èµ–ä¸å¯è¾¾/å¾ªç¯å¼•ç”¨çš„é—®é¢˜æ•è·
- DLæ‰©å±•ç­‰æ”¯æŒ

é‚£æˆ‘ä»¬æ¥çœ‹çœ‹ç»†èŠ‚å¥½äº†ã€‚

#### 1.æ— æ¥å£å®šä¹‰ç›´æ¥ç™»è®°
è™½ç„¶Bonbonsæ˜¯æŒ‰ç…§æ¥å£å®ç°çš„ä¾èµ–æ³¨å…¥ï¼Œä½†æ˜¯åŒæ ·æ”¯æŒéšå¼æ¥å£æä¾›ï¼Œå³æ¥å£æ¥æºäºå½“å‰ç™»è®°ç±»æœ¬èº«ï¼Œåœ¨ä½¿ç”¨æ—¶é€šè¿‡ç±»è‡ªèº«Constructorè·å–å¯¹åº”å®ä¾‹ã€‚è¿™æ˜¯Bonbonsæœ€åŸºæœ¬æœ€ä¾¿åˆ©çš„ä¾èµ–æ³¨å…¥æ–¹å¼ã€‚

æ¯”å¦‚æˆ‘ä»¬åˆ›å»ºäº†è¿™æ ·çš„ä¸€ä¸ªæœåŠ¡å’Œæ§åˆ¶å™¨ï¼š
```TypeScript
@Injectabe()
export class SecService {

    private id = UUID.Create();

    constructor() {}

}

@Controller("api")
export class MainController extends BaseController {

    constructor(private sec: SecService ) {
        super();
    }

}
```
>è£…é¥°å™¨éƒ¨åˆ†çš„å®ç°ç›®å‰æš‚ä¸åšè§£é‡Šï¼Œæš‚æ—¶å¯ä»¥è®¤ä¸º@Injectable()å’Œ@Controller(...)ä¸ºè¿è¡Œæ—¶æä¾›äº†è®¾è®¡æ—¶çš„ç±»å‹æºä¿¡æ¯ã€‚äº‹å®ä¸Šè£…é¥°å™¨å¯¹äºé™æ€ç±»å‹æ³¨å…¥ç³»ç»Ÿéå¸¸é‡è¦ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨åº”ç”¨é…ç½®ä¸­æ³¨å…¥ï¼š
```TypeScript
Bonbons.Create()
    .controller(MainController)
    .singleton(SecService)
    .listen(3000)
    .run(() => console.log("Example app listening on port 3000"));
```
> è¿™æ˜¯ç›®å‰Bonbonsé…ç½®åº”ç”¨å®ä¾‹çš„æ–¹å¼ï¼Œæœªæ¥æˆ‘å°†å¼•å…¥BonbonsTemplateæ¨¡å—æ¥æ¨¡æ¿åŒ–å£°æ˜å¼åœ°åˆ›å»ºåº”ç”¨ç¨‹åºï¼Œå½“ç„¶åŒæ ·ä¼šä½¿ç”¨è£…é¥°å™¨æ¥å®ç°ï¼Œå¯ä»¥å‚è€ƒAngularçš„NgModuleç­‰å®ç°æ–¹å¼ã€‚

è¿™æ ·ï¼Œåœ¨æ§åˆ¶å™¨ä¸­æˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°æˆ‘ä»¬æŒ‰ç…§å•ä¾‹æ¨¡å¼æ³¨å†Œçš„SecServiceå®ä¾‹äº†(å®ä¾‹å¦‚ä½•è·å¾—çš„å°†åœ¨åç»­è¯´æ˜)ã€‚IoCæ¨¡å¼è®©ä¾èµ–çš„è·å–æ§åˆ¶æƒæ”¶å›åˆ°äº†æ¡†æ¶ä¸­ï¼Œåœ¨ä¾èµ–å¤æ‚å¹¶ä¸”é«˜è€¦åˆçš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥å¤§å¹…åº¦é™ä½è€¦åˆåº¦ï¼Œå¸®åŠ©å†™å‡ºé«˜å¯æ‰©å±•çš„åº”ç”¨ç¨‹åºã€‚

#### 2.æŠ½è±¡ç±»æ¥å£å®ç°ä¾èµ–åˆ†ç¦»
ç›´æ¥æ³¨å…¥æœ‰æ—¶å€™æ— æ³•æ»¡è¶³ä¸€äº›åœºæ™¯çš„éœ€è¦ã€‚æœ‰æ—¶å€™æˆ‘ä»¬ä¸å…³å¿ƒæœåŠ¡å…·ä½“çš„ä¸šåŠ¡é€»è¾‘å®ç°ï¼Œæˆ‘ä»¬åªæ˜¯å¸Œæœ›æ˜ç¡®ä¸€ä¸ªæœåŠ¡éœ€è¦æœ‰å“ªäº›è¡Œä¸ºï¼Œå› æ­¤é€æ˜åŒ–äº†æœåŠ¡çš„ç»†èŠ‚ï¼Œå› ä¸ºæˆ‘ä»¬æ¯«ä¸å…³æ³¨ã€‚ä»¥è¿™æ ·çš„æ€è·¯æ¥è®¾è®¡ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“æ›¿æ¢ç³»ç»Ÿä¸­çš„ä»»ä½•ä¸€ä¸ªæœåŠ¡ï¼Œåªè¦ä»–çš„ä»–å’Œæ›¿ä»£è€…ä¸¥æ ¼æŒ‰ç…§åŒä¸€æ¥å£å®ç°ã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ¥å£ä¾èµ–æ³¨å…¥ã€‚

ä¹‹å‰è¯´äº†TypeScriptæ²¡æœ‰è¿è¡Œæ—¶æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å€ŸåŠ©æŠ½è±¡ç±»äº†ï¼Œé¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±»ï¼š
```TypeScript

export abstract class ABCService {
    public abstract getMessage(): string;
}

```

ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæœåŠ¡ï¼Œå¹¶å®ç°äº†æŠ½è±¡ç±»ï¼Œå¹¶ä¸”ä»¥ä¸åŒçš„æ–¹å¼ç™»è®°æ³¨å†Œï¼š
```TypeScript
@Injectabe()
export class MainService implements ABCService {

    private id = â€œmain service idâ€;

    constructor() { }

    public getMessage(): string {
        return this.id;
    }

}
```
```TypeScript
Bonbons.Create()
    .controller(MainController)
    .singleton(ABCService, MainService)
    .listen(3000)
    .run(() => console.log("Example app listening on port 3000"));
```
>**å› ä¸ºæˆ‘ä»¬æŠŠæŠ½è±¡ç±»ä½œä¸ºæ¥å£ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥è¿ç”¨TypeScriptçš„æ¥å£å®ç°ç‰¹æ€§ï¼Œä»ç±»å¼ºè¡ŒæŠ½ç¦»æ¥å£æ¥å®Œæˆå®ç°ï¼Œå½“ç„¶ä½ ç›´æ¥extendsä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸å¦¥ï¼Œåªæ˜¯æœ€ç»ˆåœ¨è¿è¡Œæ—¶ä¼šä¿ç•™åŸå‹ç»§æ‰¿çš„å…³ç³»ï¼Œå¦‚æœç¡®å®šéœ€è¦çš„è¯å¯ä»¥è€ƒè™‘è¿™ä¹ˆåš**

ç„¶åå†æ§åˆ¶å™¨é‡Œæ³¨å…¥å°±å¯ä»¥å¾—åˆ°ï¼š
```TypeScript
@Controller("api")
export class MainController extends BaseController {

    constructor(private main: MainService) {
        super();
        main.getMessage();
    }
}
```
ä»£ç å°†æŒ‰ç…§é¢„æœŸçš„å·¥ä½œã€‚

#### 3.å¯æ³¨å…¥é¡¹çš„ä¾èµ–å·¥å‚
é‚£ä¹ˆå¦‚ä½•å®ç°ä¾èµ–é¡¹çš„è·å–å‘¢ï¼Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œå°±æ˜¯ç›´æ¥é‡‡ç”¨å…³è”æ•°ç»„æ¥åšçš„DIå®¹å™¨ï¼Œå¯¹åº”çš„å®ç°å°±æ˜¯ES6çš„Mapã€‚
ç±»å‹(å³ES6 classçš„æ„é€ æ–¹æ³•)å°†ä½œä¸ºå…³è”çš„é”®ï¼Œè€Œå€¼åˆ™ç›¸å¯¹å¤æ‚ä¸€äº›ï¼Œä½¿ç”¨äº†å·¥å‚æ–¹æ³•ã€‚
è¿™é‡Œæ˜¯DIå®¹å™¨å•ä¸ªå€¼æ¡ç›®(DIEntry)çš„æ¥å£å®šä¹‰ï¼š
```TYPESCRIPT
interface DIEntryContract {
    _instance: any;
    _fac: any;
    getInstance() :any;
}
```
æ¯ä¸ªentryéƒ½è‡³å°‘åŒ…å«è¿™ä¸‰ä¸ªå­—æ®µã€‚getInstanceæ–¹æ³•æ˜¯å”¯ä¸€ç”¨äºè·å–ç»“æœçš„æ–¹æ³•ï¼Œå¦å¤–ä¸¤ä¸ªå­—æ®µä»åå­—ä¸Šå°±å¯ä»¥çœ‹å‡ºï¼Œæ˜¯ä½œä¸ºå†…éƒ¨æˆå‘˜å­˜åœ¨çš„ã€‚_instanceå­—æ®µä¼šåœ¨å•ä¾‹æ¨¡å¼ä¸­èµ·ä½œç”¨ï¼Œç”¨æ¥ä¿ç•™å•ä¾‹çš„å¼•ç”¨ï¼›_facåˆ™ä¿ç•™äº†å·¥å‚æ–¹æ³•çš„å¼•ç”¨ï¼Œç”¨äºäº§ç”Ÿå…¨æ–°çš„ç›®æ ‡å®ä¾‹ã€‚

é€šè¿‡å…³è”æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å¯¹åº”ç±»å‹çš„DIEntryï¼Œå¹¶é€šè¿‡getInstanceæ–¹æ³•æ‹¿åˆ°éœ€è¦çš„å®ä¾‹å¯¹è±¡å³å¯ã€‚
>è‡³äº_facå’ŒgetInstanceçš„å®ç°ï¼Œå°†åœ¨åé¢çš„å¤šé‡æ¨¡å¼ä¸­ç»§ç»­å±•å¼€ã€‚

#### 4.å•ä¾‹æ¨¡å¼å’ŒèŒƒå›´æ¨¡å¼
é€šå¸¸çš„IoCæ¡†æ¶å¯¹äºä¾èµ–é¡¹çš„èŒƒå›´ä¹Ÿæœ‰åŒºåˆ«å¯æ§åˆ¶ï¼Œæ¯”å¦‚Asp.Net Coreï¼Œä¸€ä¸ªæœåŠ¡è‡³å°‘å¯ä»¥ä½œä¸ºscopedå­˜åœ¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºsingletonå­˜åœ¨ã€‚

åœ¨Bonbonsä¸­ï¼Œä¸€ä¸ªsingletonæœåŠ¡å°±æ„å‘³ç€æ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸä¸­åªä¼šå­˜åœ¨å”¯ä¸€çš„å®ä¾‹ï¼Œå¹¶ä¸”å®ƒçš„æ„é€ æ–¹æ³•ä¾èµ–æ— è®ºæ˜¯ä»€ä¹ˆç±»å‹çš„ä¹Ÿéƒ½å°†ä½œä¸ºå•ä¾‹å­˜åœ¨ã€‚ä¸€ä¸ªscopedæœåŠ¡åˆ™ä¼šç¡®ä¿åœ¨ä¸€æ¬¡è¯·æ±‚è¿‡ç¨‹ä¸­ä¿æŒå”¯ä¸€ï¼Œå¹¶ä¸”ä»–çš„æ„é€ æ–¹æ³•ä¾èµ–ä¼šæŒ‰ç…§ä¾èµ–é¡¹è‡ªèº«çš„èŒƒå›´ç±»å‹è¡¨ç°å‡ºæ­£ç¡®çš„è¡Œä¸ºã€‚

æœåŠ¡éœ€è¦singletonè¿˜æ˜¯scopedå¾€å¾€æ˜¯æŒ‰ç…§å®é™…éœ€è¦æ¥åŒºåˆ†çš„ã€‚æ¯”å¦‚ä¸€ä¸ªæ•°æ®åº“çš„ä¸Šä¸‹æ–‡å¯¹è±¡å¾€å¾€æ˜¯scopedçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›å®ƒåœ¨ä¸åŒè¯·æ±‚ä¸­äº§ç”Ÿå‰¯ä½œç”¨ï¼Œå› ä¸ºå®ƒåªæ˜¯æ•°æ®åº“çš„ä¸€ä¸ªä»£ç†è€Œå·²ã€‚

å¦‚ä½•æ³¨å…¥ä¸åŒèŒƒå›´ç‰¹æ€§çš„æœåŠ¡å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š
```TYPESCRIPT
Bonbons.Create()
    .controller(MainController)
    .singleton(SecService)
    .scoped(SuperService)
    .listen(3000)
    .run(() => console.log("Example app listening on port 3000"));
```
åœ¨æ¡†æ¶å†…æˆ‘å®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç”¨ä»¥åŒºåˆ†ä¸åŒèŒƒå›´çš„æœåŠ¡ï¼Œç›®å‰æš‚æ—¶å®ç°äº†ä¸Šé¢ä¸¤ç§ç±»å‹ï¼š
```TYPESCRIPT
export enum InjectScope {
    Singleton = "__singleton",
    Scoped = "__scoped"
}
```

æŒ‰ç…§è¿™ä¸ªæšä¸¾ï¼Œæˆ‘é‡å»ºäº†DIEntryçš„å®ç°ï¼Œå®ç°äº†é€šè¿‡getInstanceæ–¹æ³•åŒºåˆ†ç”Ÿäº§ä¸åŒçš„èŒƒå›´å¯¹è±¡ï¼š
```TYPESCRIPT
class DIEntry {
    _instance: any;
    _fac?: any;
    constructor(private scope: InjectScope) { }
    getInstance() {
        return this.scope === InjectScope.Singleton ? 
            (this._instance || (this._instance = this._fac())) : 
            this._fac();
    }
}
```
å¯ä»¥çœ‹è§çš„æ˜¯ï¼Œscopedæ¨¡å¼ä¸‹ï¼Œæ¯ä¸€æ¬¡è¯·æ±‚å®ä¾‹éƒ½ä¼šé€šè¿‡å·¥å‚æ–¹æ³•é‡å»ºä¸€ä¸ªå…¨æ–°çš„ï¼Œè€ŒsingletonèŒƒå›´ä¸‹ï¼Œæœ€ç»ˆçš„ç»“æœæ€»æ˜¯ç›¸åŒçš„ã€‚

#### 5.æ³¨å…¥ç°æˆçš„çš„æ¥å£å®ä¾‹


> æœ¬ç¯‡Blogæœªå®Œæˆï¼Œæ­£åœ¨æ–½å·¥ä¸­...

**Source** : [**issue page**](https://github.com/mogician-notes/blog/issues/4)
